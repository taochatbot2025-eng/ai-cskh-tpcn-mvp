{
  "flows_id": "FLOWS-CSKH-TPCN-V1",
  "flows": {
    "FLOW_GREETING": {
      "steps": [
        { "type": "say", "text": "D·∫° em ch√†o anh/ch·ªã üòä Anh/ch·ªã ƒëang c·∫ßn t∆∞ v·∫•n s·∫£n ph·∫©m/ combo theo v·∫•n ƒë·ªÅ s·ª©c kh·ªèe hay h∆∞·ªõng d·∫´n mua h√†ng ·∫°?" }
      ]
    },
    "FLOW_CONSULT_COMBO": {
      "steps": [
        { "type": "guardrail", "rules": ["no_cure_claim","no_diagnosis","must_use_company_data_only"] },
        { "type": "need_entity", "entity": "problem",
          "on_missing": { "type": "ask", "text": "D·∫° anh/ch·ªã ƒëang mu·ªën h·ªó tr·ª£ v·∫•n ƒë·ªÅ n√†o ·∫° (v√≠ d·ª•: ti·ªÉu ƒë∆∞·ªùng, d·∫° d√†y, m·ª° m√°u, gan, x∆∞∆°ng kh·ªõp‚Ä¶)? üòä" } },
        { "type": "clarify_optional", "max_questions": 2,
          "questions": [
            "Anh/ch·ªã ƒëang ·ªü m·ª©c nh·∫π hay kh√≥ ch·ªãu nhi·ªÅu ·∫° (ƒë·ªÉ em g·ª£i √Ω s√°t h∆°n)?",
            "Anh/ch·ªã c√≥ ƒëang d√πng thu·ªëc b√°c sƒ© k√™ kh√¥ng ·∫°? (ƒë·ªÉ em l∆∞u √Ω an to√†n khi d√πng)"
          ] },
        { "type": "lookup", "source": "COMBOS", "query": { "target_problem": "{{problem}}", "status": "active" }, "limit": 2,
          "on_empty": { "type": "goto", "flow": "FLOW_CONSULT_PRODUCT" } },
        { "type": "lookup_expand", "source": "PRODUCTS", "from_combo_included_products": true },
        { "type": "respond_template", "template": "TEMPLATE_COMBO_REPLY" }
      ]
    },
    "FLOW_CONSULT_PRODUCT": {
      "steps": [
        { "type": "guardrail", "rules": ["no_cure_claim","no_diagnosis","must_use_company_data_only"] },
        { "type": "need_entity", "entity": "problem",
          "on_missing": { "type": "ask", "text": "D·∫° anh/ch·ªã ƒëang g·∫∑p v·∫•n ƒë·ªÅ n√†o ƒë·ªÉ em g·ª£i √Ω ƒë√∫ng (v√≠ d·ª•: d·∫° d√†y, tr√†o ng∆∞·ª£c, ti·ªÉu ƒë∆∞·ªùng‚Ä¶)? üòä" } },
        { "type": "lookup", "source": "PRODUCTS", "query": { "problems_contains": "{{problem}}", "status": "active" }, "limit": 3,
          "on_empty": { "type": "goto", "flow": "FLOW_HANDOFF" } },
        { "type": "respond_template", "template": "TEMPLATE_PRODUCTS_REPLY" }
      ]
    },
    "FLOW_FAQ_BUYING": {
      "steps": [
        { "type": "lookup_faq", "intent": "mua_hang", "limit": 3 },
        { "type": "respond_template", "template": "TEMPLATE_FAQ_REPLY" }
      ]
    },
    "FLOW_FAQ_PAYMENT": {
      "steps": [
        { "type": "lookup_faq", "intent": "thanh_toan", "limit": 3 },
        { "type": "respond_template", "template": "TEMPLATE_FAQ_REPLY" }
      ]
    },
    "FLOW_FAQ_POLICY": {
      "steps": [
        { "type": "lookup_faq", "intent": "van_chuyen", "limit": 2 },
        { "type": "lookup_faq", "intent": "doi_tra", "limit": 2, "optional": true },
        { "type": "respond_template", "template": "TEMPLATE_FAQ_REPLY" }
      ]
    },
    "FLOW_HANDOFF": {
      "steps": [
        { "type": "lookup_routing", "match": "best" },
        { "type": "respond_template", "template": "TEMPLATE_HANDOFF_REPLY" }
      ]
    },
    "FLOW_FALLBACK": {
      "steps": [
        { "type": "say", "text": "D·∫° em c√≥ th·ªÉ t∆∞ v·∫•n s·∫£n ph·∫©m/ combo theo v·∫•n ƒë·ªÅ s·ª©c kh·ªèe, h∆∞·ªõng d·∫´n mua h√†ng ‚Äì thanh to√°n, ho·∫∑c k·∫øt n·ªëi hotline khi c·∫ßn ·∫° üòä Anh/ch·ªã cho em bi·∫øt m√¨nh ƒëang c·∫ßn h·ªó tr·ª£ ph·∫ßn n√†o?" }
      ]
    }
  }
}
