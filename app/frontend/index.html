<!doctype html>
<html lang="vi">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>AI CSKH TPCN â€“ Demo Chat</title>
  <style>
    body{font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial; margin:0; background:#0b1220; color:#e6eefc;}
    .wrap{max-width:920px; margin:0 auto; padding:18px;}
    .card{background:#121b2f; border:1px solid rgba(255,255,255,.08); border-radius:14px; overflow:hidden;}
    .top{padding:14px 16px; display:flex; justify-content:space-between; align-items:center; background:rgba(255,255,255,.03)}
    .top b{font-size:14px}
    .chat{height:62vh; overflow:auto; padding:14px 16px;}
    .msg{margin:10px 0; display:flex; gap:10px; align-items:flex-start;}
    .bubble{padding:10px 12px; border-radius:12px; white-space:pre-wrap; line-height:1.35; max-width:82%;}
    .me{justify-content:flex-end}
    .me .bubble{background:rgba(96,165,250,.22); border:1px solid rgba(96,165,250,.28)}
    .bot .bubble{background:rgba(255,255,255,.06); border:1px solid rgba(255,255,255,.08)}
    .input{display:flex; gap:10px; padding:12px 16px; background:rgba(255,255,255,.03); border-top:1px solid rgba(255,255,255,.08)}
    textarea{flex:1; min-height:44px; max-height:120px; resize:vertical; padding:10px 12px; border-radius:12px; border:1px solid rgba(255,255,255,.14); background:#0b1220; color:#e6eefc}
    button{padding:10px 14px; border-radius:12px; border:1px solid rgba(255,255,255,.18); background:#1b2a4a; color:#e6eefc; cursor:pointer}
    button:disabled{opacity:.6; cursor:not-allowed}
    .hint{font-size:12px; color:rgba(230,238,252,.7); padding:10px 16px}
    .chips{display:flex; flex-wrap:wrap; gap:8px; padding:0 16px 12px}
    .chip{font-size:12px; padding:6px 10px; border-radius:999px; border:1px solid rgba(255,255,255,.14); background:rgba(255,255,255,.04); cursor:pointer}
  </style>
</head>
<body>
  <div class="wrap">
    <div class="card">
      <div class="top">
        <div>
          <b>AI CSKH TPCN â€“ Demo</b>
          <div style="font-size:12px;color:rgba(230,238,252,.75)">Backend: <span id="api"></span></div>
        </div>
        <a href="/health" style="color:#93c5fd;font-size:12px;text-decoration:none">health</a>
      </div>

      <div class="hint">Gá»£i Ã½ test nhanh ðŸ‘‡</div>
      <div class="chips" id="chips"></div>

      <div class="chat" id="chat"></div>
      <div class="input">
        <textarea id="txt" placeholder="Nháº­p cÃ¢u há»i... (vd: Bá»‹ tiá»ƒu Ä‘Æ°á»ng dÃ¹ng combo nÃ o?)"></textarea>
        <button id="send">Gá»­i</button>
      </div>
    </div>
  </div>

<script>
const API = location.origin;
document.getElementById("api").textContent = API;

const SUGGEST = [
  "NgÆ°á»i bá»‹ tiá»ƒu Ä‘Æ°á»ng dÃ¹ng combo nÃ o?",
  "Äau dáº¡ dÃ y / trÃ o ngÆ°á»£c dÃ¹ng sáº£n pháº©m nÃ o?",
  "Má»¡ mÃ¡u cao dÃ¹ng gÃ¬?",
  "Mua hÃ ng nhÆ° tháº¿ nÃ o? CÃ³ COD khÃ´ng?",
  "Uá»‘ng bao lÃ¢u khá»i? CÃ³ cam káº¿t khÃ´ng?",
  "ChÃ­nh sÃ¡ch Ä‘áº¡i lÃ½/hoa há»“ng?"
];

const chat = document.getElementById("chat");
const txt = document.getElementById("txt");
const btn = document.getElementById("send");
const chips = document.getElementById("chips");

SUGGEST.forEach(s=>{
  const c=document.createElement("div");
  c.className="chip";
  c.textContent=s;
  c.onclick=()=>{ txt.value=s; txt.focus(); };
  chips.appendChild(c);
});

function add(role, content){
  const row=document.createElement("div");
  row.className="msg " + (role==="me"?"me":"bot");
  const b=document.createElement("div");
  b.className="bubble";
  b.textContent=content;
  row.appendChild(b);
  chat.appendChild(row);
  chat.scrollTop=chat.scrollHeight;
}

async function send(){
  const m = txt.value.trim();
  if(!m) return;
  add("me", m);
  txt.value="";
  btn.disabled=true;
  try{
    const res = await fetch(API + "/chat", {
      method:"POST",
      headers:{ "Content-Type":"application/json" },
      body: JSON.stringify({ message: m })
    });
    const data = await res.json();
    add("bot", data.reply || "(no reply)");
  }catch(e){
    add("bot", "Lá»—i káº¿t ná»‘i. Kiá»ƒm tra backend nhÃ© áº¡.");
  }finally{
    btn.disabled=false;
  }
}
btn.onclick=send;
txt.addEventListener("keydown",(e)=>{
  if(e.key==="Enter" && !e.shiftKey){ e.preventDefault(); send(); }
});
add("bot","Dáº¡ em chÃ o anh/chá»‹ ðŸ˜Š Anh/chá»‹ cáº§n tÆ° váº¥n sáº£n pháº©m/combo hay hÆ°á»›ng dáº«n mua hÃ ng áº¡?");
</script>
</body>
</html>
